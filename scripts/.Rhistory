ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45))
cols_2 = c('New cases' = '#E08B00', 'New deaths' = 'red')
df_italy_new = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
mutate('new_cases' = c(NA, diff(conf)),
'new_deaths' = c(NA, diff(died))) %>%
select(time_base, new_cases, new_deaths)
p_new = ggplot(df_italy_new, aes(x = time_base)) +
geom_col(aes(y = new_cases, fill = 'New cases'), alpha = .7) +
geom_col(aes(y = new_deaths, fill = 'New deaths'), alpha = .7) +
#geom_line(aes(y = new_cases), col = 'black', lwd = .5) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols_2) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45))
p_new
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 1)
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "2020-03-09 \nLockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "2020-05-04 \nLockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45))
p_cumul
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10)
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c("2020-03-09", "2020-05-04",
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45))
p_cumul
c("2020-03-09", "2020-05-04",
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10))
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10)
c("2020-03-09", "2020-05-04",
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10))
c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10))
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = .5))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 10))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = .7))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = .7))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = .7, hjust = .7))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = .7, hjust = 0))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = .7, hjust = 1))
p_cumul
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
p_cumul
p_new = ggplot(df_italy_new, aes(x = time_base)) +
geom_col(aes(y = new_cases, fill = 'New cases'), alpha = .7) +
geom_col(aes(y = new_deaths, fill = 'New deaths'), alpha = .7) +
#geom_line(aes(y = new_cases), col = 'black', lwd = .5) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols_2) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45))
p_new
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 1)
p_new = ggplot(df_italy_new, aes(x = time_base)) +
geom_col(aes(y = new_cases, fill = 'New cases'), alpha = .7) +
geom_col(aes(y = new_deaths, fill = 'New deaths'), alpha = .7) +
#geom_line(aes(y = new_cases), col = 'black', lwd = .5) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols_2) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
p_new
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 1)
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c()) +
# scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
#                         seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
#              ) +
labs(y = "", x = "") +
theme(legend.position = 'right', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
p_cumul
p_new = ggplot(df_italy_new, aes(x = time_base)) +
geom_col(aes(y = new_cases, fill = 'New cases'), alpha = .7) +
geom_col(aes(y = new_deaths, fill = 'New deaths'), alpha = .7) +
#geom_line(aes(y = new_cases), col = 'black', lwd = .5) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols_2) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'right', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 1)
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7)),
labels = c()) +
labs(y = "", x = "") +
theme(legend.position = 'right', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
p_cumul
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 1)
p_new = ggplot(df_italy_new, aes(x = time_base)) +
geom_col(aes(y = new_cases, fill = 'New cases'), alpha = .7) +
geom_col(aes(y = new_deaths, fill = 'New deaths'), alpha = .7) +
#geom_line(aes(y = new_cases), col = 'black', lwd = .5) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols_2) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
scale_y_continuous(labels = scales::label_number()) +
labs(y = "", x = "") +
theme(legend.position = 'right', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 1)
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 2)
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7)),
labels = c()) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
cols_2 = c('New cases' = '#E08B00', 'New deaths' = 'red')
df_italy_new = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
mutate('new_cases' = c(NA, diff(conf)),
'new_deaths' = c(NA, diff(died))) %>%
select(time_base, new_cases, new_deaths)
p_new = ggplot(df_italy_new, aes(x = time_base)) +
geom_col(aes(y = new_cases, fill = 'New cases'), alpha = .7) +
geom_col(aes(y = new_deaths, fill = 'New deaths'), alpha = .7) +
#geom_line(aes(y = new_cases), col = 'black', lwd = .5) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols_2) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 7))
) +
scale_y_continuous(labels = scales::label_number()) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 2)
p_cumul = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
ggplot(., aes(x = time_base)) +
geom_col(aes(y = conf, fill = 'Total-cumul'), alpha = .7) +
geom_col(aes(y = died, fill = 'Died-cumul'), alpha = .7) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = df_sub[which(df_sub$loc == 'Italy' & df_sub$time_base == max(df_sub$time_base)), 'conf'],
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols) +
scale_y_continuous(labels = scales::label_number()) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 6))
) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
df_italy_new = df_sub %>%
filter(loc == "Italy", timenorm_num >= 1) %>%
mutate('new_cases' = c(NA, diff(conf)),
'new_deaths' = c(NA, diff(died))) %>%
select(time_base, new_cases, new_deaths)
p_new = ggplot(df_italy_new, aes(x = time_base)) +
geom_col(aes(y = new_cases, fill = 'New cases'), alpha = .7) +
geom_col(aes(y = new_deaths, fill = 'New deaths'), alpha = .7) +
#geom_line(aes(y = new_cases), col = 'black', lwd = .5) +
geom_vline(aes(xintercept = as.Date("2020-03-09")), linetype = 2) +
annotate(x = as.Date("2020-03-09"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown starts") +
geom_vline(aes(xintercept = as.Date("2020-05-04")), linetype = 2) +
annotate(x = as.Date("2020-05-04"), hjust = 0.5, geom = 'label',
y = max(df_italy_new[, 2:3], na.rm = T),
label = "Lockdown ends") +
scale_fill_manual(name="Legend", values=cols_2) +
scale_x_date(breaks = c(as.Date(c("2020-03-09", "2020-05-04")),
seq(min(df_italy_new$time_base), max(df_italy_new$time_base), length.out = 6))
) +
scale_y_continuous(labels = scales::label_number()) +
labs(y = "", x = "") +
theme(legend.position = 'top', axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
gridExtra::grid.arrange(grobs = list(p_cumul, p_new), ncol = 2)
p_combi = gridExtra::arrangeGrob(grobs = list(p_cumul, p_new), ncol = 2)
ggsave('~/Documents/covid-r-plots/italy-new-cumul-cases-deaths.png',
plot = p_combi, height = 8, width = 12)
ggsave('~/Documents/covid-r-plots/italy-new-cumul-cases-deaths.png',
plot = p_combi, height = 7, width = 12)
ggsave('~/Documents/covid-r-plots/italy-new-cumul-cases-deaths.png',
plot = p_combi, height = 7, width = 14)
